# AI IDE 集成指南

本文档介绍如何将 Prompt Chaining 技能集成到主流 AI IDE 中，使 AI 助手在每次对话中自动遵循链式思维。

---

## Claude Code

### 集成方式

在项目根目录的 `CLAUDE.md` 文件中嵌入链式提示原则。Claude Code 会自动读取此文件作为上下文。

### 配置示例

在 `CLAUDE.md` 中添加以下内容：

```markdown
## 工作流程

处理复杂任务时，遵循链式提示流程：

1. **分析**：先理解上下文，阅读相关代码，明确约束
2. **生成**：提出至少 2 种实现方案
3. **选择**：对比方案，选出最优解
4. **补充**：细化实施计划，考虑测试策略
5. **综合**：逐步实施，每步验证

原则：
- 先读代码再写代码
- 保持与项目现有风格一致
- 避免过度设计，只解决当前问题
- 小型任务可合并前三步，但不可跳过思考过程
```

### 进阶用法

**层级配置：** Claude Code 支持多层级的 `CLAUDE.md`：
- 根目录的 `CLAUDE.md`：全局规则
- 子目录的 `CLAUDE.md`：该模块的特定规则

可以在根目录设置通用的链式流程，在子目录中针对特定模块调整策略。

**结合 TodoWrite：** Claude Code 内置任务追踪工具，可以与链式流程配合：
- 分析阶段创建任务列表
- 每完成一个步骤标记为完成
- 动态添加发现的新任务

---

## Cursor

### 集成方式

在项目根目录的 `.cursorrules` 文件中配置链式提示规则。Cursor 会将此文件作为系统提示的一部分。

### 配置示例

创建 `.cursorrules` 文件：

```
你是一个遵循链式提示方法论的 AI 编程助手。

## 核心流程

面对任何非trivial的编码任务，按以下步骤执行：

### 分析阶段
- 先阅读用户提到的所有相关文件
- 理解项目的代码风格和架构模式
- 识别任务的约束条件和影响范围

### 方案阶段
- 在心中构思至少两种实现路径
- 如果方案涉及重要权衡，向用户展示选项

### 实施阶段
- 选择最简洁且一致的方案
- 逐步实施，关注每一步的正确性
- 修改后检查是否破坏了现有功能

## 约定
- 遵循项目现有的命名和代码风格
- 不添加不必要的抽象层
- 不添加未被要求的功能
- 优先修改现有文件而非创建新文件
```

### Cursor 特有技巧

**利用 Composer 模式：** Cursor 的 Composer 天然支持多文件编辑，适合链式流程中的综合阶段。建议：
- 在 Chat 模式完成分析和方案设计
- 切换到 Composer 模式执行多文件修改

**标签引用：** 在对话中使用 `@文件名` 引用具体文件，帮助 AI 在分析阶段快速获取上下文。

---

## Windsurf

### 集成方式

Windsurf 使用 `.windsurfrules` 文件（类似 Cursor 的 `.cursorrules`）。

### 配置示例

创建 `.windsurfrules` 文件：

```
## 链式提示工作流

执行编码任务时遵循以下流程：

1. 理解：阅读相关代码，理解上下文和约定
2. 规划：设计实现方案，考虑替代方案
3. 实施：逐步编码，保持代码风格一致性
4. 验证：检查实现的正确性和完整性

## 重要规则
- 每次修改前先阅读目标文件
- 遵循项目现有的代码风格
- 修改范围保持最小化
- 提供清晰的修改说明
```

### Windsurf 特有技巧

**Cascade 模式：** Windsurf 的 Cascade 是一个自动化的代码生成流程，与链式提示的理念高度契合。可以利用 Cascade 的多步执行能力来自然地实现链式流程。

---

## 通用集成策略

### "两次对话"模式

对于大型任务，可以采用"两次对话"策略来获得更好的结果：

**第一次对话 — 规划：**
```
我需要实现 [功能描述]。请帮我：
1. 分析当前代码结构和相关文件
2. 提出 2-3 种实现方案
3. 推荐最优方案并说明理由
4. 给出详细的实施步骤

先不要写代码，只做规划。
```

**第二次对话 — 执行：**
```
按照以下计划实施 [功能]：

[粘贴第一次对话的方案]

请按步骤执行，每完成一步告诉我结果。
```

**为什么有效：**
- 规划和执行分离，每次对话的上下文更聚焦
- 用户可以在两次对话之间审查和调整方案
- 避免单次对话上下文过长导致质量下降

### 长会话管理

当对话变长时，AI 的注意力和准确度可能下降。以下策略可以缓解：

**1. 阶段性总结**

在链式流程的每个阶段结束时，要求 AI 生成当前状态的总结：
```
请总结一下我们到目前为止的进展：
- 已完成的修改
- 当前正在处理的问题
- 接下来的步骤
```

**2. 适时开启新对话**

以下信号表明应该开始新对话：
- 对话已超过 20 轮交互
- AI 开始重复之前的错误
- AI 忘记了之前讨论过的约束
- 任务方向发生了重大变化

**3. 上下文锚定**

在长对话中定期重申关键约束：
```
提醒：我们在修改 auth 模块，注意：
- 不要改动 session 的接口签名
- 所有新方法需要加单元测试
- 保持向后兼容
```

**4. 任务拆分**

将大任务拆成多个独立的小任务，每个小任务在独立的对话中完成：
```
任务清单：
1. [对话1] 重构数据库查询层
2. [对话2] 添加缓存层
3. [对话3] 更新 API 端点
4. [对话4] 集成测试
```

---

## 跨 IDE 注意事项

| 特性 | Claude Code | Cursor | Windsurf |
|------|------------|--------|----------|
| 配置文件 | `CLAUDE.md` | `.cursorrules` | `.windsurfrules` |
| 多文件编辑 | 原生支持 | Composer 模式 | Cascade 模式 |
| 终端访问 | 完整终端 | 内置终端 | 内置终端 |
| 上下文管理 | 自动压缩 | 手动 @引用 | 自动索引 |
| 最佳搭配 | 完整五阶段流程 | Chat + Composer 组合 | Cascade 自动流程 |

### 通用最佳实践

1. **配置文件纳入版本控制**：让团队所有成员共享相同的 AI 行为约定
2. **定期更新规则**：随着项目演进，及时更新 AI 的指导规则
3. **团队统一**：确保团队成员使用一致的链式提示策略
4. **保留灵活性**：规则应该是指导性的而非约束性的，允许 AI 在特定情况下做出合理调整
